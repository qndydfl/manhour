{% extends "manning/base/base.html" %}
{% load static %}

{% block title %}마스터 데이터 관리 | Manning System{% endblock title %}

{% block navsize %}style="max-width: 900px;"{% endblock navsize %}
{% block navhome %}href="{% url 'index' %}"{% endblock navhome %} 
{% block navname %}<span>홈 페이지</span>{% endblock navname %} 
{% block navreturn %}
<a
    href="{% url 'paste_data' %}"
    class="btn btn-outline-secondary btn-sm text-light border-secondary"
>
    <i class="bi bi-clock-history"></i>
    <span class="d-none d-md-inline">되돌아가기</span>
</a>
{% endblock navreturn %}

{% block content %}
<div class="container mt-4 mb-5" style="max-width: 900px; padding-top: 100px;">

    <div class="d-flex justify-content-between align-items-center mb-4" data-aos="fade-down">
        <div class="d-flex align-items-center gap-2">            
            <h4 class="fw-bold m-0 text-dark ms-2">마스터 데이터 관리</h4>
        </div>
        
        {% if taskmasters %}
        <form action="{% url 'delete_all_taskmasters' %}" method="POST" class="d-inline">
            {% csrf_token %}
            <input type="hidden" name="next" value="master_data_list"> 
            <button type="submit" 
                    class="btn btn-outline-danger btn-sm rounded-pill px-3 fw-bold shadow-sm"
                    onclick="return confirm('⚠️ 경고: 모든 데이터를 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.');">
                <i class="bi bi-trash3-fill me-1"></i> 전체 삭제
            </button>
        </form>
        {% endif %}
    </div>

    <div class="card border-0 shadow-lg rounded-4 overflow-hidden" data-aos="fade-up">
        <div class="card-header bg-white border-bottom pt-4 pb-3 px-4">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <div class="bg-soft-success p-3 rounded-circle">
                        <i class="bi bi-database-check fs-4 text-success"></i>
                    </div>
                    <div>
                        <h5 class="fw-bold mb-1">등록된 작업 목록</h5>
                        <p class="text-muted small mb-0">총 <strong class="text-primary">{{ total_count }}</strong>개의 데이터가 있습니다.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body p-0">
            {% if taskmasters %}
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0 text-nowrap">
                    <thead class="bg-light text-muted small text-uppercase">
                        <tr>
                            <th class="py-3 ps-4" style="width: 10%;">기번</th>
                            <th class="py-3" style="width: 15%;">Work Order</th>
                            <th class="py-3" style="width: 10%;">OP</th>
                            <th class="py-3" style="width: 40%;">설명 (Description)</th>
                            <th class="py-3 text-end" style="width: 10%;">기준 M/H</th>
                            <th class="py-3 text-center" style="width: 10%;">관리</th>
                        </tr>
                    </thead>
                    <tbody class="border-top-0">
                        {% for t in taskmasters %}
                        <tr>
                            <td class="ps-4 fw-bold text-dark">{{ t.gibun_code }}</td>
                            <td><span class="badge bg-light text-dark border fw-normal">{{ t.work_order }}</span></td>
                            <td><span class="text-muted small">{{ t.op }}</span></td>
                            <td>
                                <div class="text-truncate" style="max-width: 350px;" title="{{ t.description }}">
                                    {{ t.description }}
                                </div>
                            </td>
                            <td class="text-end fw-bold text-primary">{{ t.default_mh }}</td>
                            <td class="text-center">
                                <form action="{% url 'delete_taskmaster' t.id %}" method="POST" class="d-inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="next" value="master_data_list">
                                    <button type="submit" 
                                            class="btn btn-sm btn-light text-danger border-0 rounded-circle" 
                                            style="width: 32px; height: 32px;"
                                            onclick="return confirm('이 항목을 삭제하시겠습니까?');"
                                            data-bs-toggle="tooltip" 
                                            title="삭제">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <div class="text-muted opacity-25 mb-3"><i class="bi bi-folder-x" style="font-size: 4rem;"></i></div>
                <h5 class="fw-bold text-muted">등록된 데이터가 없습니다.</h5>
                <p class="text-muted small mb-4">새로운 데이터를 등록하여 작업을 시작하세요.</p>
                <a href="{% url 'paste_data' %}" class="btn btn-primary rounded-pill px-4 fw-bold">
                    <i class="bi bi-plus-lg me-1"></i> 데이터 등록하러 가기
                </a>
            </div>
            {% endif %}
        </div>
        
        <div class="card-footer bg-light border-0 py-3 text-center text-muted small">
            데이터 관리는 관리자 권한이 필요할 수 있습니다.
        </div>
    </div>
</div>
{% endblock content %}