{% load static %}

<!doctype html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="theme-color" content="#f2f2f7" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />

        <title>{% block title %}Manning System{% endblock title %}</title>

        <link
            rel="stylesheet"
            crossorigin
            href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/aos@2.3.1/dist/aos.css"
        />

        <link
            rel="icon"
            href="{% static 'favicon.svg' %}"
            type="image/svg+xml"
        />

        <link rel="stylesheet" href="{% static 'css/base.css' %}" />
        {% block css %}{% endblock css %}

        <script
            defer
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        ></script>
        <script defer src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"
        ></script>

        <script defer src="{% static 'js/base.js' %}"></script>
        {% block js %}{% endblock js %}
    </head>
    <body>
        {% block background_image %}{% endblock background_image %}
        {% with url_name=request.resolver_match.url_name %}
        {% if url_name != "login" and url_name != "index" %}
        <div class="app-shell">
            <aside class="app-sidebar" aria-label="Primary">
                <div class="app-sidebar__brand">Menu</div>
                <nav class="app-sidebar__nav">
                    <a class="app-sidebar__link" href="{% url 'index' %}">
                        <i class="bi bi-house"></i> Dash Board(Home)
                    </a>
                    <a class="app-sidebar__link" href="{% url 'session_list' %}">
                        <i class="bi bi-grid"></i> Session List
                    </a>
                    <a class="app-sidebar__link" href="{% url 'create_session' %}">
                        <i class="bi bi-plus-circle"></i> New Session
                    </a>
                    <a class="app-sidebar__link" href="{% url 'history' %}">
                        <i class="bi bi-clock-history"></i> History
                    </a>
                    <a class="app-sidebar__link" href="{% url 'master_data_list' %}">
                        <i class="bi bi-database"></i> Master Data
                    </a>
                    <a class="app-sidebar__link" href="{% url 'paste_data' %}">
                        <i class="bi bi-clipboard-plus"></i> Data Registration
                    </a>
                    <a class="app-sidebar__link" href="{% url 'settings' %}">
                        <i class="bi bi-gear"></i> Settings
                    </a>
                </nav>
            </aside>
            <div
                class="sidebar-overlay js-sidebar-toggle"
                data-sidebar-action="close"
                aria-hidden="true"
            ></div>
            <div class="page-content has-sidebar">
        {% else %}
        <div class="page-content">
        {% endif %}
            <header class="ios-topbar">
                {% include "manning/navbar/navbar_base.html" %}
            </header>

            <main class="ios-wrap">
                {% if messages %}
                <div class="toast-container position-fixed top-0 end-0 p-3">
                    {% for message in messages %}
                    <div
                        class="toast align-items-center text-white bg-dark border-0 shadow-lg"
                        role="alert"
                        aria-live="assertive"
                        aria-atomic="true"
                    >
                        <div class="d-flex">
                            <div class="toast-body">{{ message }}</div>
                            <button
                                type="button"
                                class="btn-close btn-close-white me-2 m-auto"
                                data-bs-dismiss="toast"
                                aria-label="Close"
                            ></button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %} {% block content %}{% endblock content %}
            </main>

            {% block footer %}{% endblock footer %}
        </div>
        {% if url_name != "login" and url_name != "index" %}
        </div>
        {% endif %}
        {% endwith %}

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                if (typeof AOS !== "undefined") {
                    AOS.init({
                        duration: 800,
                        easing: "ease-in-out",
                        once: true,
                    });
                }
            });
            
            // 사이드 바 위치 설정을 세션 스토리지에서 읽어와 적용
            (function() {
                const sidePos = sessionStorage.getItem('sidebarPosition') || 'left';
                if (sidePos === 'right') {
                    document.body.classList.add('sidebar-right');
                }
                // 사이드바를 기본적으로 숨긴 상태로 시작하려면 미리 클래스 추가
                document.body.classList.remove('sidebar-open');
            })();

        </script>
    </body>
</html>
