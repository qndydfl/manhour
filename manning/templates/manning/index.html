{% extends 'manning/base/base.html' %} 
{% load static %} 

{% block title %}대시보드 | Manning System{% endblock %} 

{% block css %}
<link rel="stylesheet" href="{% static 'css/index.css' %}" />
{% endblock css %} 

{% block js %}
<script defer src="{% static 'js/index.js' %}"></script>
{% endblock js %} 

{% block background_image %}
<div class="index-bg">
    {% static "img/default.jpg" as index_bg %} 
    {% include "manning/image/background_url.html" with bg_key="index" bg_default=index_bg %}
</div>
{% endblock background_image %} 

{% block content %}
<div class="row g-4" data-aos="fade-up" data-aos-duration="1000">
    <div class="col-lg-7 d-flex flex-column justify-content-center">
        <div class="p-3 glass-panel glass-panel rounded-3">
            <h1 class="h3 fw-bold text-dark">
                Work Smart, <br />Manage Better.
            </h1>
            <p class="text-secondary my-4" style="font-size: 0.9rem">
                작업 세션을 생성하고 실시간으로 인력을 관리하세요.<br />
                효율적인 업무 배정이 여기서 시작됩니다.
            </p>

            <div class="d-flex flex-wrap gap-3 align-items-center">
                <a
                    href="{% url 'create_session' %}"
                    class="btn btn-info btn-sm rounded-4 px-2 shadow-sm fw-bold"
                >
                    <i class="bi bi-plus-lg me-1"></i> 새 세션 시작
                </a>

                <a
                    href="{% url 'session_list' %}"
                    class="btn btn-dark btn-sm rounded-4 px-2 shadow-sm fw-bold"
                >
                    <i class="bi bi-grid-fill me-1"></i> 현황판 입장
                </a>
                <a
                    href="{% url 'master_data_list' %}"
                    class="btn btn-danger btn-sm rounded-4 px-2 shadow-sm fw-bold"
                >
                    <i class="bi bi-database-add"></i> 데이터 등록 현황
                </a>
            </div>
        </div>
    </div>

    <div class="col-lg-5">
        <div
            class="card shadow-lg h-100"
            style="
                background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            "
        >
            <div class="position-absolute" style="top: -20px; right: -20px">
                <i
                    class="bi bi-clock"
                    style="font-size: 10rem; color: rgba(255, 255, 255, 0.1)"
                ></i>
            </div>

            <div
                class="card-body border-0 p-4 d-flex flex-column justify-content-center z-1 h-100"
                style="background: rgba(15, 23, 42, 0.55)"
            >
                <div
                    class="d-flex justify-content-between align-items-center mb-4"
                >
                    <span class="fw-bold text-warning letter-spacing-1"
                        ><i class="bi bi-globe2 me-1"></i> GLOBAL TIME</span
                    >
                    <span class="badge bg-danger rounded-pill px-3">LIVE</span>
                </div>

                <div class="row align-items-end g-0 fw-bold">
                    <div class="col-7">
                        <small
                            class="text-white text-uppercase"
                            style="letter-spacing: 1px"
                            >Local Time</small
                        >
                        <div
                            class="h2 fw-bold my-1 text-white"
                            id="digital-time"
                            style="
                                font-family: &quot;Courier New&quot;, monospace;
                            "
                        >
                            00:00:00
                        </div>
                        <small class="text-white" id="digital-date"
                            >Loading...</small
                        >
                        <small class="text-white" id="digital-weekday"
                            >Loading...</small
                        >
                    </div>

                    <div
                        class="col-5 text-end border-start border-secondary ps-3"
                    >
                        <small
                            class="text-white text-uppercase fw-bold"
                            style="letter-spacing: 1px"
                            >UTC</small
                        >
                        <div
                            class="h2 fw-bold my-1 text-warning"
                            id="digital-time-utc"
                            style="
                                font-family: &quot;Courier New&quot;, monospace;
                            "
                        >
                            00:00
                        </div>
                        <small class="text-white" id="digital-date-utc"
                            >Loading...</small
                        >
                        <small class="text-white" id="digital-weekday-utc"
                            >Loading...</small
                        >
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div
    class="row g-4 mt-4 opacity-75 d-flex justify-content-center align-items-center"
    data-aos="fade-down"
    data-aos-duration="1000"
>
    <div
        class="d-flex flex-wrap gap-2 justify-content-center align-items-center"
    >
        {% if index_videos %}
        <div class="dropdown d-inline-block">
            <button
                type="button"
                class="btn btn-warning btn-sm rounded-4 px-2 shadow-sm fw-bold dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
            >
                <i class="bi bi-play-btn-fill me-1"></i> 유튜브 동영상
            </button>
            <ul class="dropdown-menu">
                {% for video in index_videos %}
                <li>
                    <button
                        type="button"
                        class="dropdown-item"
                        data-bs-toggle="modal"
                        data-bs-target="#videoModal"
                        data-video-url="{{ video.youtube_url }}"
                        data-video-title="{{ video.title }}"
                    >
                        {{ video.title }}
                    </button>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% else %}
        <button
            type="button"
            class="btn btn-warning btn-sm rounded-4 px-2 shadow-sm fw-bold"
            disabled
            title="관리자에서 영상을 등록하세요"
        >
            <i class="bi bi-play-btn-fill me-1"></i> 유튜브 동영상
        </button>
        {% endif %} {% if index_shorts %}
        <div class="dropdown d-inline-block">
            <button
                type="button"
                class="btn btn-outline-warning btn-sm rounded-4 px-2 shadow-sm fw-bold dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
            >
                <i class="bi bi-youtube me-1"></i> Shorts
            </button>
            <ul class="dropdown-menu">
                {% for video in index_shorts %}
                <li>
                    <button
                        type="button"
                        class="dropdown-item"
                        data-bs-toggle="modal"
                        data-bs-target="#videoModal"
                        data-video-url="{{ video.youtube_url }}"
                        data-video-title="{{ video.title }}"
                    >
                        {{ video.title }}
                    </button>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% else %}
        <button
            type="button"
            class="btn btn-outline-warning btn-sm rounded-4 px-2 shadow-sm fw-bold"
            disabled
            title="관리자에서 쇼츠를 등록하세요"
        >
            <i class="bi bi-youtube me-1"></i> Shorts
        </button>
        {% endif %}
    </div>
</div>

<div
    class="row g-4 mt-4 opacity-75"
    data-aos="fade-down"
    data-aos-duration="1000"
>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100 rounded-4 hover-lift">
            <div class="card-body p-4 d-flex align-items-center">
                <div
                    class="icon-circle bg-primary bg-opacity-10 text-primary me-3"
                >
                    <i class="bi bi-activity"></i>
                </div>
                <div>
                    <h6 class="text-muted text-uppercase fw-bold small mb-1">
                        Active Sessions
                    </h6>
                    <h2 class="fw-bold text-dark mb-0">
                        <span class="active-count-num">{{ active_count }}</span
                        ><span class="fs-6 text-muted ms-1">개</span>
                    </h2>
                </div>
                <a href="{% url 'session_list' %}" class="stretched-link"></a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100 rounded-4 hover-lift">
            <div class="card-body p-4 d-flex align-items-center">
                <div
                    class="icon-circle bg-success bg-opacity-10 text-success me-3"
                >
                    <i class="bi bi-archive"></i>
                </div>
                <div>
                    <h6 class="text-muted text-uppercase fw-bold small mb-1">
                        History Archive
                    </h6>
                    <h2 class="fw-bold text-dark mb-0">
                        <span class="history-count-num"
                            >{{ history_count }}</span
                        ><span class="fs-6 text-muted ms-1">건</span>
                    </h2>
                </div>
                <a href="{% url 'history' %}" class="stretched-link"></a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100 rounded-4 hover-lift">
            <div class="card-body p-4 d-flex align-items-center">
                <div class="icon-circle bg-info bg-opacity-10 text-info me-3">
                    <i class="bi bi-database-add"></i>
                </div>
                <div>
                    <h6 class="text-muted text-uppercase fw-bold small mb-1">
                        Master Data
                    </h6>
                    <h5 class="fw-bold text-dark mb-0">데이터 관리</h5>
                </div>
                <a href="{% url 'paste_data' %}" class="stretched-link"></a>
            </div>
        </div>
    </div>
</div>

<div
    class="modal fade"
    id="videoModal"
    tabindex="-1"
    aria-labelledby="videoModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 rounded-4 overflow-hidden">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="videoModalLabel">
                    <i class="bi bi-play-circle me-1"></i> Video
                </h5>
                <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>

            <div class="modal-body p-0 bg-black">
                <div class="ratio ratio-16x9">
                    <iframe
                        id="youtubeFrame"
                        src=""
                        referrerpolicy="origin-when-cross-origin"
                        title="YouTube video player"
                        allow="
                            accelerometer;
                            autoplay;
                            clipboard-write;
                            encrypted-media;
                            gyroscope;
                            picture-in-picture;
                            web-share;
                        "
                        allowfullscreen
                    ></iframe>
                </div>
                <div class="p-3 d-flex justify-content-end gap-2 bg-dark">
                    <a
                        id="openOnYoutube"
                        class="btn btn-sm btn-danger"
                        href="#"
                        target="_blank"
                        rel="noopener"
                    >
                        <i class="bi bi-youtube me-1"></i> YouTube에서 열기
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="index-footer-spacer"></div>

{% block footer %}
<footer
    class="text-center text-white py-3 mt-4 bg-secondary index-footer-fixed"
>
    <small class="opacity-50">
        &copy; 2026 Man Hour Calculator System. All rights reserved.
    </small>
</footer>
{% endblock footer %}
{% endblock content %}
