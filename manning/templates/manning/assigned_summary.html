{% extends "manning/base/base.html" %} 
{% load static %} 

{% block title %}ë°°ì • ìš”ì•½ | Manning System{% endblock title %} 

{% block css %}
<link rel="stylesheet" href="{% static 'css/result_view.css' %}" />
<link rel="stylesheet" href="{% static 'css/assigned_summary.css' %}" />
<style>
    /* ìš”ì•½ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ ë³´ì • */
    .summary-table td {
        background: transparent !important;
        color: #212529;
    }
    .status-badge {
        width: 80px;
        display: inline-block;
    }
</style>
{% endblock css %} 

{% block background_image %}
    {% include "manning/image/background_url.html" with bg_key="assigned_summary" bg_default="https://picsum.photos/id/500/1600/900?grayscale&blur=2" %} 
{% endblock background_image %} 


{% block content %}
<div
    class="container my-4 py-4 glass-panel rounded-3 shadow-lg"
    style="max-width: 1000px"
>
    <div class="d-flex align-items-center mb-4 px-2" data-aos="fade-down">
        <h4 class="fw-bold text-dark my-4">ğŸ“… ë°°ì • í˜„í™© ìš”ì•½</h4>
        <div class="ms-auto">
            <span class="badge bg-dark rounded-pill px-3 py-2 shadow-sm">
                ì´ ì¸ì›: {{ workers_schedule|length }}ëª…
            </span>
            <a
                href="{% if not session.is_active %}{% url 'index' %}{% else %}{% url 'result_view' session.id %}{% endif %}"
                class="btn btn-outline-dark btn-sm rounded-pill fw-bold ms-2"
            >
                <i class="bi bi-arrow-left"></i>
                <span class="d-none d-md-inline">ì´ì „ í™”ë©´ìœ¼ë¡œ</span>
            </a>
        </div>
    </div>

    <div
        class="alert glass-panel border-0 d-flex align-items-center gap-2 small text-dark mb-4 py-3 shadow-sm"
        data-aos="fade-in"
    >
        <i class="bi bi-info-circle-fill text-primary fs-5"></i>
        <span>
            M/H í•œë„ë¥¼ ì´ˆê³¼í•˜ë©´
            <strong class="text-danger">Overload</strong> ìƒíƒœê°€ ë©ë‹ˆë‹¤. 
            (ì£¼ê°„ ê¸°ì¤€: <strong>10.5</strong> / ì•¼ê°„ ê¸°ì¤€: <strong>11.0</strong>)
        </span>
    </div>

    <div
        class="card glass-panel border-0 shadow-lg overflow-hidden mb-4"
        data-aos="fade-up"
    >
        <div class="table-responsive">
            <table class="table table-hover align-middle summary-table mb-0">
                <thead class="bg-white bg-opacity-50 p-0">
                    <tr class="text-secondary text-center">
                        <th style="width: 25%" class="">ì‘ì—…ì / ê·¼ë¬´ì¡°</th>
                        <th style="width: 5%" class="text-center">ê±´ìˆ˜</th>
                        <th style="width: 10%" class="text-center">ìƒíƒœ</th>
                        <th style="width: 35%" class="text-center">M/H ì§„í–‰ë¥ </th>
                        <th style="width: 25%" class="text-center">ìƒì„¸ë³´ê¸°</th>
                    </tr>
                </thead>
                <tbody>
                    {% for w in workers_schedule %} 
                    {% if w.is_night %} 
                    {% widthratio w.total_mh 11.0 100 as ratio %} {% else %} 
                    {% widthratio w.total_mh 10.5 100 as ratio %} {% endif %}

                    <tr class="hover-row">
                        <td class="text-center">
                            <div class="d-flex align-items-center justify-content-center gap-2">
                                <div class="fw-bold text-dark text-center fs-6">
                                    {{ w.worker_name }}
                                </div>
                                {% if w.is_night %}
                                <span
                                    class="badge bg-dark rounded-pill ms-1"
                                    style="font-size: 0.7em"
                                    >ì•¼ê°„</span
                                >
                                {% else %}
                                <span
                                    class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 rounded-pill ms-1"
                                    style="font-size: 0.7em"
                                    >ì£¼ê°„</span
                                >
                                {% endif %}
                            </div>
                        </td>

                        <td class="text-center">
                            <span class="fw-bold text-secondary"
                                >{{ w.task_count }}</span
                            >
                        </td>

                        <td class="text-center">
                            {% if ratio|add:'0' > 100 %}
                            <span
                                class="badge bg-danger rounded-pill shadow-sm status-badge"
                                >Overload</span
                            >
                            {% else %}
                            <span
                                class="badge bg-success bg-opacity-75 text-white rounded-pill shadow-sm status-badge"
                                >Normal</span
                            >
                            {% endif %}
                        </td>

                        <td>
                            <div class="d-flex align-items-center gap-3">
                                <div class="flex-grow-1">
                                    <div
                                        class="progress bg-dark bg-opacity-10"
                                        style="height: 10px; border-radius: 5px"
                                    >
                                        <div
                                            class="progress-bar {% if ratio|add:'0' > 100 %}bg-danger shadow-sm{% else %}bg-primary{% endif %}"
                                            role="progressbar"
                                            style="width: {% if ratio|add:'0' > 100 %}100{% else %}{{ ratio|default:0 }}{% endif %}%; transition: width 1s ease-in-out;"
                                            aria-valuenow="{{ ratio|default:0 }}"
                                            aria-valuemin="0"
                                            aria-valuemax="100"
                                        ></div>
                                    </div>
                                </div>
                                <div class="text-end" style="min-width: 85px">
                                    <span
                                        class="fw-bold {% if ratio|add:'0' > 100 %}text-danger{% else %}text-dark{% endif %}"
                                    >
                                        {{ w.total_mh|floatformat:1 }}
                                    </span>
                                    <span
                                        class="text-muted"
                                        style="font-size: 0.8rem"
                                        >/ {% if w.is_night %}11.0{% else %}10.5{% endif %}</span
                                    >
                                </div>
                            </div>
                        </td>

                        <td class="text-center">
                            <a
                                href="{% url 'personal_schedule' session.id %}?worker_id={{ w.worker.id }}"
                                class="btn btn-sm btn-outline-secondary rounded-pill py-1 px-3 fw-bold"
                                style="font-size: 0.75rem"
                            >
                                <i class="bi bi-calendar-check me-1"></i> ê°œì¸ ì‹œê°„í‘œ 
                                {% if not session.is_active %}
                                <span
                                    class="badge text-bg-secondary ms-2"
                                    style="font-size: 0.65rem"
                                >
                                    ì‘ì—… ì™„ë£Œ
                                </span>
                                {% endif %}
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5 text-muted">
                            <i
                                class="bi bi-people fs-1 d-block mb-3 opacity-25"
                            ></i>
                            ë°°ì •ëœ ì‘ì—…ìê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endblock content %}
</div>
